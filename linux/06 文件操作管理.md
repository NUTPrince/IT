# 查看磁盘和目录的容量

- 查看磁盘的容量

```bash
df
```

`/dev/sda2` 是对应着主机硬盘的分区，后面的数字表示分区号，数字前面的字母 a 表示第几块硬盘（也可能是可移动磁盘），你如果主机上有多块硬盘则可能还会出现 `/dev/sdb`，`/dev/sdc` 这些磁盘设备都会在 `/dev` 目录下以文件的存在形式。

接着你还会看到"1k-块"这个陌生的东西，它表示以磁盘块大小的方式显示容量，后面为相应的以块大小表示的已用和可用容量，现在以一种我们看得懂的方式展示：

```shell
df -h
```
（这样即可使用命令查看你主机磁盘的使用情况）

- 查看目录的容量

这个命令前面其实已经用了很多次了：

```shell
du
```
(默认以块的大小展示)

```shell
du -h
```
(加上 `-h` 参数，以更易读的方式展示)



```bash
du -h -d 0 ~   # 查看 1 级目录信息
```
```shell
du -h -d 1 ~   # 查看 2 级目录信息
```
(`-d` 参数指定查看目录的深度)

**下面涉及的命令具有一定的危险性，操作不当可能会丢失你的个人数据，初学者建议在虚拟环境中进行操作。**

# 简单的磁盘管理

首先我们会先创建一个虚拟磁盘来进行后续的练习操作

## 创建虚拟磁盘

#### dd 命令简介

`dd` 命令用于转换和复制文件，不过它的复制不同于 `cp`。之前提到过关于 Linux 的很重要的一点，**一切即文件**，在 Linux 上，硬件的设备驱动（如硬盘）和特殊设备文件（如 `/dev/zero` 和 `/dev/random`）都像普通文件一样，只是在各自的驱动程序中实现了对应的功能，`dd` 也可以读取文件或写入这些文件。这样，`dd` 也可以用在备份硬件的引导扇区、获取一定数量的随机数据或者空数据等任务中。`dd` 程序也可以在复制时处理数据，例如转换字节序、或在 ASCII 与 EBCDIC 编码间互换。

`dd` 的命令行语句与其他的 Linux 程序不同，因为它的命令行选项格式为 **选项=值**，而不是更标准的 **--选项 值** 或 **-选项=值**。`dd` 默认从标准输入中读取，并写入到标准输出中，但可以用选项 `if`（input file，输入文件）和 `of`（output file，输出文件）改变。

### 创建虚拟镜像文件

通过上面一小节，你应该掌握了 `dd` 的基本使用，下面就来使用 `dd` 命令来完成创建虚拟磁盘的第一步。

从 `/dev/zero` 设备创建一个容量为 1024M 的空文件：
```shell
dd if=/dev/zero of=virtual.img bs=1M count=1024
```

```shell
du -h virtual.img
```

### 格式化磁盘

在命令行输入 `sudo mkfs` 然后按下 `<Tab>` 键，你可以看到很多个以 mkfs 为前缀的命令，这些不同的后缀其实就是表示着不同的文件系统，可以用 mkfs 格式化成的文件系统。

```shell
sudo mkfs.ext4 virtual.img
```

### 挂载磁盘到目录树

用户在 Linux/UNIX 的机器上打开一个文件以前，包含该文件的文件系统必须先进行挂载的动作，此时用户要对该文件系统执行 `mount` 的指令以进行挂载。该指令通常是使用在 USB 或其他可移除存储设备上，而根目录则需要始终保持挂载的状态。又因为 Linux/UNIX 文件系统可以对应一个文件而不一定要是硬件设备，所以可以挂载一个包含文件系统的文件到目录树。

Linux/UNIX 命令行的 `mount` 指令是告诉操作系统，对应的文件系统已经准备好，可以使用了，而该文件系统会对应到一个特定的点（称为挂载点）。挂载好的文件、目录、设备以及特殊文件即可提供用户使用。

我们先来使用 `mount` 来查看下主机已经挂载的文件系统：
```shell
sudo mount
```

输出的结果中每一行表示一个设备或虚拟设备，每一行最前面是设备名，然后是 on 后面是挂载点，type 后面表示文件系统类型，再后面是挂载选项（比如可以在挂载时设定以只读方式挂载等等）。

### 磁盘分区

```shell
sudo fdisk -l
```
(查看硬盘分区表信息 )

输出结果中开头显示了主机上的磁盘的一些信息，包括容量扇区数，扇区大小，I/O 大小等信息。

我们重点看一下这几个: `/dev/sda1`，`/dev/sda2` 为主分区分别安装了 Windows 和 Linux 操作系统，`/dev/sda3` 为交换分区（可以理解为虚拟内存），`/dev/sda4` 为扩展分区其中包含 `/dev/sda5`，`/dev/sda6`，`/dev/sda7`，`/dev/sda8` 四个逻辑分区，因为主机上有几个分区之间有空隙，没有对齐边界扇区，所以分区之间不是完全连续的。

```shell
sudo fdisk virtual.img
```
(进入磁盘分区模式 )

