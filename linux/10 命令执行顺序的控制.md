# 管道

管道是一种通信机制，通常用于进程间的通信（也可通过 socket 进行网络通信），它表现出来的形式就是将前面每一个进程的输出（stdout）直接作为下一个进程的输入（stdin）。

管道又分为匿名管道和具名管道（这里将不会讨论在源程序中使用系统调用创建并使用管道的情况，它与命令行的管道在内核中实际都是采用相同的机制）。我们在使用一些过滤程序时经常会用到的就是匿名管道，在命令行中由 `|` 分隔符表示，`|` 在前面的内容中我们已经多次使用到了。具名管道简单的说就是有名字的管道，通常只会在源程序中用到具名管道。下面我们就将通过一些常用的可以使用管道的过滤程序来帮助你熟练管道的使用。

`grep` 命令是很强大的，也是相当常用的一个命令，它结合正则表达式可以实现很复杂却很高效的匹配和查找，不过在学习正则表达式之前，这里介绍它简单的使用，而关于正则表达式后面将会有单独一小节介绍到时会再继续学习 `grep` 命令和其他一些命令。

`grep` 命令的一般形式为：

```bash
grep [命令选项]... 用于匹配的表达式 [文件]...
```

>管道符，“|”，表示将前一个命令的处理结果输出通过管道传递给后面的命令进行处理。

# wc 命令
wc 命令用于统计并输出一个文件中行、单词和字节的数目，比如输出 `/etc/passwd` 文件的统计信息：

```bash
wc /etc/passwd
```

**注意：对于西文字符来说，一个字符就是一个字节，但对于中文字符一个汉字是大于 2 个字节的，具体数目是由字符编码决定的。**

# sort 排序命令

将输入按照一定方式排序，然后再输出，它支持的排序有按字典排序，数字排序，按月份排序，随机排序，反转排序，指定特定字段进行排序等等。

默认为字典排序：

```bash
cat /etc/study | sort
```

反转排序：

```bash
cat /etc/study | sort -r
```

按特定字段排序：

```bash
cat /etc/study | sort -t':' -k 3
```

上面的`-t`参数用于指定字段的分隔符，这里是以":"作为分隔符；`-k 字段号`用于指定对哪一个字段进行排序。这里`/etc/passwd`文件的第三个字段为数字，默认情况下是以字典序排序的。

# uniq 去重命令

`uniq` 命令可以用于过滤或者输出重复行。

-   过滤重复行

我们可以使用 `history` 命令查看最近执行过的命令（实际为读取 `${SHELL}_history` 文件，如我们环境中的 `.zsh_history` 文件），不过你可能只想查看使用了哪个命令而不需要知道具体干了什么，那么你可能就会要想去掉命令后面的参数然后去掉重复的命令：

```bash
history | cut -c 8- | cut -d ' ' -f 1 | uniq
```

然后经过层层过滤，你会发现确是只输出了执行的命令那一列，不过去重效果好像不明显，仔细看你会发现它确实去重了，只是不那么明显，之所以不明显是因为 `uniq` 命令只能去连续重复的行，不是全文去重，所以要达到预期效果，我们先排序：

```bash
history | cut -c 8- | cut -d ' ' -f 1 | sort | uniq
```

```shell
history | cut -c 8- | cut -d ' ' -f 1 | sort -u
```

这就是 Linux/UNIX 哲学吸引人的地方，大繁至简，一个命令只干一件事却能干到最好。
