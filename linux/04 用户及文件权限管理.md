# 用户管理

## 查看用户

```shell
who am i 

# 或者 

who mom likes
```

> `who` 命令其它常用参数

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code></td>
<td>打印能打印的全部</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>打印死掉的进程</td>
</tr>
<tr>
<td><code>-m</code></td>
<td>同<code>am i</code>，<code>mom likes</code></td>
</tr>
<tr>
<td><code>-q</code></td>
<td>打印当前登录用户数及用户名</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>打印当前登录用户登录信息</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>打印运行等级</td>
</tr>
</tbody></table>

## 创建用户

在 Linux 系统里， `root` 账户拥有整个系统至高无上的权限，比如新建和添加用户。

> root 权限，系统权限的一种，与 SYSTEM 权限可以理解成一个概念，但高于 Administrator 权限，root 是 Linux 和 UNIX 系统中的超级管理员用户帐户，该帐户拥有整个系统至高无上的权力。
> 
> （tips：所有对象root后都可以操作，所以很多黑客在入侵系统的时候，都要把权限提升到 root 权限，这个操作等同于在 Windows 下就是将新建的非法帐户添加到 Administrators 用户组。更比如安卓操作系统中（基于 Linux 内核）获得 root 权限之后就意味着已经获得了手机的最高权限，这时候你可以对手机中的任何文件（包括系统文件）执行所有增、删、改、查的操作。）

大部分 Linux 系统在安装时都会建议用户新建一个用户而不是直接使用 root 用户进行登录，当然也有直接使用 root 登录的例如 Kali（基于 Debian 的 Linux 发行版，集成大量工具软件，主要用于数字取证的操作系统）。一般我们登录系统时都是以普通账户的身份登录的，要创建用户需要 root 权限，这里就要用到 `sudo` 这个命令了。

不过使用这个命令有两个大前提：

一是你要知道当前登录用户的密码，二是当前用户必须在 `sudo` 用户组。

### su，su- 与 sudo
`su <user>` 可以切换到用户 user，执行时需要输入目标用户的密码

`su -l <user>` 命令也是切换用户，但是同时用户的环境变量和工作目录也会跟着改变成目标用户所对应的。

`sudo <cmd>` 可以以特权级别运行 cmd 命令，需要当前用户属于 sudo 组，且需要输入当前用户的密码。

（tips：***需要注意 Linux 环境下输入密码是不会显示的。***）

例如现在新建一个叫 `nut` 的用户：
```shell
sudo adduser nut
```

这个命令不但可以添加用户到系统，同时也会默认为新用户在 /home 目录下创建一个工作目录。

现在已经创建好一个用户，使用如下命令切换登录用户：
```shell
su -l nut
```

新建用户如果不指定用户组的话，默认会自动创建一个与用户名相同的用户组。

## 用户组
>在 Linux 里面每个用户都有一个归属（用户组），用户组简单地理解就是一组用户的集合，它们共享一些资源和权限，同时拥有私有资源，就跟家的形式差不多，你的兄弟姐妹（不同的用户）属于同一个家（用户组），你们可以共同拥有这个家（共享资源），爸妈对待你们都一样（共享权限），你偶尔写写日记，其他人未经允许不能查看（私有资源和权限）。当然一个用户是可以属于多个用户组的，正如你既属于家庭，又属于学校或公司。

**查看属于哪些用户组：**

+ 方法一：使用 groups 命令
```shell
groups shiyanlou
```

默认情况下在 sudo 用户组里的可以使用 sudo 命令获得 root 权限。


+ 方法二：查看 `/etc/group` 文件
```shell
cat /etc/group | sort
```

这里 `cat` 命令用于读取指定文件的内容并打印到终端输出，后面会详细讲它的使用。`| sort` 表示将读取的文本进行一个字典排序再输出，然后你将看到如下一堆输出。

然后使用 `grep` 命令过滤掉一些你不想看到的结果：
```shell
cat /etc/group | grep -E "nut"
```

##### `/etc/group` 文件格式说明

/etc/group 的内容包括用户组（Group）、用户组口令、GID（组 ID） 及该用户组所包含的用户（User），每个用户组一条记录。格式如下：
> group_name:password:GID:user_list

输出的 password 字段为一个 `x`，并不是说密码就是它，只是表示密码不可见而已。

这里需要注意，如果用户的 GID 等于用户组的 GID，那么最后一个字段 `user_list` 就是空的，这里的 GID 是指用户默认所在组的 GID，可以使用 `id` 命令查看。

##### 将指定用户添加到`sudo`用户组

>使用 `usermod` 命令可以为用户添加用户组，同样使用该命令你必需有 root 权限，你可以直接使用 root 用户为其它用户添加用户组，或者用其它已经在 sudo 用户组的用户使用 sudo 命令获取权限来执行该命令。

在`sudo`用户组的用户下执行该命令：
```shell
sudo usermod -G sudo nut
```

使用`groups`查看其是否已经处于`sudo`用户组
```shell
groups nut
```



##### 删除用户

使用如下命令：
```shell
sudo deluser lilei --remove-home
```

(使用 `--remove-home` 参数在删除用户时候会一并将该用户的工作目录一并删除。如果不使用那么系统会自动在 /home 目录为该用户保留工作目录。)

删除用户组可以使用 `groupdel` 命令，倘若该群组中仍包括某些用户，则必须先删除这些用户后，才能删除群组。

# 文件权限

## 查看权限

>文件权限就是文件的访问控制权限，即哪些用户和组群可以访问文件以及可以执行什么样的操作。
>
>Unix/Linux 系统是一个典型的多用户系统，不同的用户处于不同的地位，对文件和目录有不同的访问权限。为了保护系统的安全性，Unix/Linux 系统除了对用户权限作了严格的界定外，还在用户身份认证、访问控制、传输安全、文件读写权限等方面作了周密的控制。
>
>在 Unix/Linux 中的每一个文件或目录都包含有访问权限，这些访问权限决定了谁能访问和如何访问这些文件和目录。

以长格式列出所有文件：
```shell
ls -al
```

![[3-1.png]]

![[3-2.png]]

-   文件类型

关于文件类型，这里有一点你必需时刻牢记 **Linux 里面一切皆文件**，正因为这一点才有了设备文件（ `/dev` 目录下有各种设备文件，大都跟具体的硬件设备相关）这一说。
`socket`：网络套接字。

`pipe` 管道。

`软链接文件`：链接文件是分为两种的，另一种当然是“硬链接”（硬链接不常用，软链接等同于 Windows 上的快捷方式）。

-   文件权限

读权限，表示你可以使用 `cat <file name>` 之类的命令来读取某个文件的内容；写权限，表示你可以编辑和修改某个文件的内容；

执行权限，通常指可以运行的二进制程序文件或者脚本文件，如同 Windows 上的 `exe` 后缀的文件，不过 Linux 上不是通过文件后缀名来区分文件的类型。你需要注意的一点是，**一个目录同时具有读权限和执行权限才可以打开并查看内部文件，而一个目录要有写权限才允许在其中创建其它文件**，这是因为目录文件实际保存着该目录里面的文件的列表等信息。

所有者权限，这一点相信你应该明白了，至于所属用户组权限，是指你所在的用户组中的所有其它用户对于该文件的权限。

-   链接数

链接到该文件所在的 inode 结点的文件名数目。拓展知识：[[硬链接，软链接，inode]]。

-   文件大小

 以 inode 结点大小为单位来表示的文件大小，你可以给 ls 加上 `-lh` 参数来更直观的查看文件的大小。

## 变更权限

### 1、更改文件属组(chgrp)

```shell
chgrp [-R] 属组名文件名
```

-   -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。

### 2、更改文件所属用户以及文件属组(chown)

```shell
chown [–R] 属主名 文件名
chown [-R] 属主名：属组名 文件名
```

-   -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。

### 3、更改文件属性(chmod)

```shell
ls -al
```

Linux文件的基本权限就有九个，分别是owner/group/others三种身份各有自己的read/write/execute权限。

首先第一个字符用来标识是文件还是目录，这里只列出两个有代表性的：

-   当为[ - ]则代表文件
-   当为[ d ]则是目录

Linux文件属性有两种设置方法，一种是**数字**，一种是**符号**。

#### 数字类型改变文件权限

假设一个文件的权限字符为：『-rwxrwxrwx』， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：

-   r:4
-   w:2
-   x:1

每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： [-rwxrwx---] 分数则是：

-   owner = rwx = 4+2+1 = 7
-   group = rwx = 4+2+1 = 7
-   others= --- = 0+0+0 = 0

```shell
chmod [-R] xyz 文件或目录
```

-   xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。
-   -R : 进行递归(recursive)的持续变更，亦即连同此目录下的所有文件都会变更


#### 符号类型改变文件权限

Linux有**user 、group 、others三种身份**。用u, g, o来代表三种身份的权限。

| 参数 | 表示     | 含义                |
|:---:|:------:|:-----------------:|
| u  | user   | 即文件或目录的所有者        |
| g  | group  | 即与文件属主有相同组ID的所有用户 |
| o  | others | 表示“其他用户”          |
| a  | all    | 表示“所有用户”系统默认值     |

|       例子        | 等价于 |                                  含义                                  |
|:-----------------:|:------:|:----------------------------------------------------------------------|
| \-rwx\-\-\-\-\-\- |  700   |  \-:文件, u=rwx\(读/写/执行\), g=\-\-\-\(无权限\), o=\-\- \(无权限\)   |
| \-rw\-r\-\-r\-\-  |  644   |        \-:文件, u=rw\-\(读/写\), g=r\-\-\(读\), o=r\-\- \(读\)         |
|   drwxrw\-rw\-    |  766   |     d:目录,u=rwx\(读/写/执行\), g=rw\-\(读/写\), o=rw\- \(读/写\)      |
|    drwxrwxrwx     |  777   | d:文目录,u=rwx\(读/写/执行\), g=rwx\(读/写/执行\), o=rwx\(读/写/执行\) |
其中『rwx』 的三个参数的组合。其中，[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)。

操作符号:
-   +添加某个权限

例如给所有人添加可写入权限：
```shell
chmod a+w hello.txt
```
【a+w】:  `a` 代表所有人(all)，`+` 代表添加权限，`w` 代表可以写入。

-   -取消某个权限
例如给所有者(u)、所属组(g)添加可执行权限，但是其他用户(o)不可拥有执行权限
```shell
chmod ug+x,o-x 1.txt 2.txt  
```
【ug+x,o-x】：`ug` 代表所有者(u)、所属组(g)，`+` 代表添加权限，`-` 代表取消权限，`x` 代表可执行。

# 拓展阅读

上文提到各权限的分数对照表：
-   r:4
-   w:2
-   x:1

其原理是二进制数字表示：

![pic](https://doc.shiyanlou.com/linux_base/3-14.png)

每个文件有三组固定的权限，分别对应拥有者，所属用户组，其他用户，**记住这个顺序是固定的**。文件的读写执行对应字母 `rwx`，以二进制表示就是 `111`，用十进制表示就是 `7`。

